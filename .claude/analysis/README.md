# Analysis Cache

This directory stores dynamically generated codebase metrics.

## Purpose

Replace hardcoded values (like "30 aggregates", "158 endpoints") with real-time counts.

## Usage in Commands/Agents

### Read Metrics Before Starting

```bash
# In bash-based commands
METRICS=$(cat .claude/analysis/codebase_metrics.json)
TOTAL_AGGREGATES=$(echo "$METRICS" | jq -r '.domain.aggregates.total')
TOTAL_ENDPOINTS=$(echo "$METRICS" | jq -r '.api.endpoints.total')
TOTAL_AGENTS=$(echo "$METRICS" | jq -r '.agents.total')

echo "Analyzing $TOTAL_AGGREGATES aggregates across $TOTAL_ENDPOINTS endpoints..."
```

### Generate Fresh Metrics

```bash
# Run before analysis
./scripts/generate_codebase_metrics.sh

# Now metrics are fresh
cat .claude/analysis/codebase_metrics.json | jq
```

## Files

- `codebase_metrics.json` - Main metrics file (auto-generated)
- `last_run.json` - Metadata about last analysis run
- `domain_model.json` - Deep domain analysis (from `/pre-analyze --deep`)
- `api.json` - API analysis (from `/pre-analyze`)
- `testing.json` - Test coverage analysis (from `/pre-analyze`)

## Regeneration

Metrics are automatically regenerated by:
1. `/pre-analyze` command (calls `generate_codebase_metrics.sh`)
2. Manual: `./scripts/generate_codebase_metrics.sh`

## Cache Validity

- **Fresh**: < 1 day old
- **Stale**: 1-7 days old (warn user)
- **Expired**: > 7 days old (force regeneration)
