# ü§ñ PROMPT: AN√ÅLISE ARQUITETURAL DDD COMPLETA

> **Instru√ß√µes:** Copie o prompt abaixo e execute. A IA sobrescrever√° este arquivo com a an√°lise completa.

---

## üìù PROMPT PARA IA (COPIE TUDO ABAIXO)

```
# AN√ÅLISE ARQUITETURAL DDD - VENTROS CRM

Voc√™ √© um arquiteto de software especialista em Domain-Driven Design (DDD), Clean Architecture e padr√µes t√°ticos/estrat√©gicos.

**IMPORTANTE:** Voc√™ tem acesso completo ao c√≥digo-fonte do projeto em `/home/caloi/ventros-crm/`. 

**TAREFA:** Analise TODO o c√≥digo-fonte e gere uma avalia√ß√£o arquitetural COMPLETA e DETALHADA seguindo EXATAMENTE a estrutura abaixo. Sobrescreva o arquivo `/home/caloi/ventros-crm/TASKS-2.md` com sua an√°lise.

---

## ‚ö†Ô∏è REGRA CR√çTICA: TRAZER TUDO

**VOC√ä DEVE LISTAR:**

1. ‚úÖ **O QUE J√Å EST√Å IMPLEMENTADO** - Tudo que existe no c√≥digo, mesmo que:
   - N√£o tenha testes
   - N√£o tenha l√≥gica completa
   - Seja apenas estrutura/interface
   - Tenha coment√°rios TODO/FIXME
   - Esteja parcialmente implementado

2. ‚ùå **O QUE N√ÉO EST√Å IMPLEMENTADO** - Tudo que deveria existir mas n√£o existe:
   - Agregados ausentes
   - Value Objects faltantes
   - Domain Services n√£o implementados
   - Specifications ausentes
   - Factories ausentes
   - Testes ausentes
   - Documenta√ß√£o ausente

3. ‚ö†Ô∏è **O QUE EST√Å INCOMPLETO** - C√≥digo que existe mas precisa de trabalho:
   - M√©todos vazios
   - TODOs no c√≥digo
   - Valida√ß√µes faltantes
   - Tratamento de erros incompleto

**FORMATO PARA CADA ELEMENTO:**

```markdown
#### [Nome do Elemento]
**Status:** ‚úÖ Implementado / ‚ö†Ô∏è Parcial / ‚ùå Ausente
**Localiza√ß√£o:** [caminho do arquivo] (se existir)
**Implementa√ß√£o:** [% de completude estimado]
**Detalhes:** [o que tem e o que falta]
```

**EXEMPLO:**
```markdown
#### Agregado: Contact
**Status:** ‚úÖ Implementado
**Localiza√ß√£o:** `/internal/domain/contact/contact.go`
**Implementa√ß√£o:** 95%
**Detalhes:** 
- ‚úÖ Entidade Contact completa
- ‚úÖ Value Objects: Email, Phone
- ‚úÖ Domain Events: ContactCreated, ContactUpdated
- ‚úÖ Repository Interface
- ‚ö†Ô∏è Falta: Specification para filtros complexos
- ‚ùå Falta: Testes unit√°rios para m√©todo UpdateProfilePicture()
```

---

## üìã CONTEXTO DO SISTEMA

**Nome:** Ventros CRM  
**Dom√≠nio:** Customer Relationship Management (CRM)  
**Stack:** Go (Golang), GORM, GIN, PostgreSQL, RabbitMQ, Temporal, Redis  

**Funcionalidades Principais:**
- Gest√£o de contatos e conversas multicanal
- Pipeline de vendas e automa√ß√µes
- Processamento de mensagens com IA
- Tracking e analytics
- Billing e subscriptions

**Estrutura de Pastas Esperada:**
```
/home/caloi/ventros-crm/
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ domain/           # Camada de Dom√≠nio (agregados, VOs, events)
‚îÇ   ‚îî‚îÄ‚îÄ application/      # Camada de Aplica√ß√£o (use cases, DTOs)
‚îú‚îÄ‚îÄ infrastructure/       # Camada de Infraestrutura (repos, DB, HTTP)
‚îú‚îÄ‚îÄ cmd/                  # Entry points
‚îî‚îÄ‚îÄ ...
```

---

## üéØ ESTRUTURA OBRIGAT√ìRIA DA AN√ÅLISE

Sua an√°lise DEVE seguir EXATAMENTE esta estrutura. N√£o pule se√ß√µes.

---

### 1. SUM√ÅRIO EXECUTIVO

Crie uma tabela com notas gerais:

| Camada | Nota | Status | Observa√ß√µes |
|--------|------|--------|-------------|
| **Dom√≠nio** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [observa√ß√£o breve] |
| **Aplica√ß√£o** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [observa√ß√£o breve] |
| **Infraestrutura** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [observa√ß√£o breve] |
| **Interface** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [observa√ß√£o breve] |
| **Eventos** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [observa√ß√£o breve] |

**Pontua√ß√£o Geral: X.X/10**

---

### 2. BOUNDED CONTEXTS IDENTIFICADOS

Liste TODOS os bounded contexts encontrados no c√≥digo:

Para cada bounded context:
- **Nome do Bounded Context**
- **Agregados principais**
- **Status da implementa√ß√£o** (completo/parcial/inicial)
- **Nota** (0-10)
- **Observa√ß√µes**

Exemplo:
```
### BC: Contact Management
- **Agregados:** Contact, ContactList, ContactEvent
- **Status:** Completo
- **Nota:** 9.0/10
- **Observa√ß√µes:** Bem implementado com VOs (Email, Phone)
```

---

### 3. CAMADA DE DOM√çNIO - AN√ÅLISE DETALHADA

**Instru√ß√µes:** Explore `/internal/domain/` e liste TODOS os elementos encontrados.

#### 3.1. AGREGADOS (Aggregate Roots)

Para CADA agregado encontrado (E CADA AGREGADO AUSENTE), crie uma se√ß√£o assim:

```markdown
#### Agregado: [Nome]
**Status:** ‚úÖ Implementado / ‚ö†Ô∏è Parcial / ‚ùå Ausente
**Localiza√ß√£o:** `/internal/domain/[pasta]/[arquivo].go` (se existir)
**Implementa√ß√£o:** [X%]

**Entidades:**
- [Nome da Entity Root] ‚úÖ/‚ö†Ô∏è/‚ùå
- [Outras entities, se houver] ‚úÖ/‚ö†Ô∏è/‚ùå

**Value Objects:**
- [Nome do VO] ‚úÖ Implementado / ‚ùå Ausente (deveria ter)
- [Outro VO] ‚úÖ/‚ùå

**Enums/Types:**
- [Nome do Enum/Type] ‚úÖ (valores: x, y, z) / ‚ùå Ausente

**Domain Events:**
- [NomeDoEvento] ‚úÖ Implementado / ‚ö†Ô∏è Definido mas n√£o usado / ‚ùå Ausente
- [OutroEvento] ‚úÖ/‚ö†Ô∏è/‚ùå

**Repository Interface:**
- [NomeDoRepository] ‚úÖ Completo / ‚ö†Ô∏è Parcial / ‚ùå Ausente
- Localiza√ß√£o: `/internal/domain/[pasta]/repository.go`
- M√©todos: [liste todos os m√©todos da interface]

**Repository Implementation:**
- [NomeGormRepository] ‚úÖ Implementado / ‚ö†Ô∏è Parcial / ‚ùå Ausente
- Localiza√ß√£o: `/infrastructure/persistence/gorm_[nome]_repository.go`
- M√©todos implementados: [X/Y]

**M√©todos de Neg√≥cio:**
Liste TODOS os m√©todos p√∫blicos (implementados E vazios):
- `MetodoX(params) error` ‚úÖ Implementado
- `MetodoY(params)` ‚ö†Ô∏è Implementado mas sem valida√ß√£o
- `MetodoZ(params)` ‚ùå Definido mas vazio (TODO)

**Invariantes Protegidas:**
- ‚úÖ [Invariante 1 - implementada]
- ‚ö†Ô∏è [Invariante 2 - parcialmente validada]
- ‚ùå [Invariante 3 - n√£o validada]

**Testes:**
- Testes unit√°rios: ‚úÖ Sim / ‚ö†Ô∏è Parcial / ‚ùå N√£o
- Cobertura estimada: [X%]
- Localiza√ß√£o: [caminho do arquivo _test.go]

**Nota:** X/10 ‚úÖ/‚ö†Ô∏è/‚ùå

**O que TEM (Pontos Fortes):**
- [Ponto forte 1 com exemplo de c√≥digo]
- [Ponto forte 2]

**O que FALTA (Pontos de Melhoria):**
- ‚ùå [Ausente: descri√ß√£o do que n√£o existe]
- ‚ö†Ô∏è [Incompleto: descri√ß√£o do que precisa melhorar]
- üí° [Sugest√£o: descri√ß√£o da melhoria]
```

**IMPORTANTE:** 
1. Fa√ßa isso para TODOS os agregados encontrados em `/internal/domain/`
2. Liste tamb√©m agregados que DEVERIAM existir mas N√ÉO existem
3. Para cada m√©todo, indique se est√° implementado, parcial ou vazio

---

#### 3.2. VALUE OBJECTS

Liste TODOS os Value Objects (implementados E ausentes):

**Value Objects IMPLEMENTADOS:**

| Value Object | Status | Localiza√ß√£o | Valida√ß√µes | M√©todos | Testes | Nota |
|--------------|--------|-------------|------------|---------|--------|------|
| Email | ‚úÖ Completo | `/internal/domain/contact/value_objects.go` | Regex, lowercase | Equals(), String() | ‚úÖ Sim | 9.5/10 |
| Phone | ‚úÖ Completo | `/internal/domain/contact/value_objects.go` | Limpeza, tamanho | Equals(), String() | ‚ö†Ô∏è Parcial | 9.0/10 |
| [Outro VO] | ‚úÖ/‚ö†Ô∏è/‚ùå | [caminho] | [valida√ß√µes] | [m√©todos] | ‚úÖ/‚ö†Ô∏è/‚ùå | X/10 |

**Total de VOs Implementados:** [n√∫mero]

---

**Value Objects AUSENTES (Oportunidades):**

Liste campos que DEVERIAM ser VOs mas s√£o strings/primitivos:

| VO Sugerido | Dom√≠nio | Campo Atual | Tipo Atual | Justificativa | Prioridade |
|-------------|---------|-------------|------------|---------------|------------|
| MessageText | Message | text | *string | Validar tamanho m√°ximo (4096 chars) | üî¥ Alta |
| MediaURL | Message | mediaURL | *string | Validar formato de URL | üü° M√©dia |
| HexColor | Pipeline | color | string | Validar formato hexadecimal (#RRGGBB) | üü° M√©dia |
| Money | Billing | amount | float64 | Valor + moeda (evitar erros) | üî¥ Alta |
| Timezone | Contact | timezone | *string | Validar timezone IANA | üü¢ Baixa |
| [Outro] | [dom√≠nio] | [campo] | [tipo] | [justificativa] | üî¥/üü°/üü¢ |

**Total de VOs Ausentes:** [n√∫mero]

---

#### 3.3. DOMAIN SERVICES

Liste TODOS os Domain Services encontrados (ou indique aus√™ncia):

| Domain Service | Localiza√ß√£o | Responsabilidade | Nota |
|----------------|-------------|------------------|------|
| [Nome] | [caminho] | [descri√ß√£o] | X/10 |

**Domain Services Ausentes (Oportunidades):**
- `PasswordPolicyService` - validar pol√≠ticas de senha
- [Outros...]

---

#### 3.4. SPECIFICATIONS

Liste TODAS as Specifications encontradas (ou indique aus√™ncia):

| Specification | Localiza√ß√£o | Uso | Nota |
|---------------|-------------|-----|------|
| [Nome] | [caminho] | [descri√ß√£o] | X/10 |

**Status:** ‚úÖ Implementado / ‚ùå Ausente

---

#### 3.5. FACTORIES

Liste TODAS as Factories encontradas:

| Factory | Localiza√ß√£o | Tipo | Nota |
|---------|-------------|------|------|
| [Nome] | [caminho] | Expl√≠cita/Impl√≠cita (New*) | X/10 |

**Observa√ß√£o:** Se usar padr√£o `New*`, indique se √© suficiente ou se precisa de Factory expl√≠cita.

---

#### 3.6. DOMAIN EVENTS

Liste TODOS os Domain Events encontrados:

| Event | Localiza√ß√£o | Agregado | Payload | Nota |
|-------|-------------|----------|---------|------|
| ContactCreated | `/internal/domain/contact/events.go` | Contact | contactID, name, ... | 9/10 |
| [Outro] | [caminho] | [agregado] | [campos] | X/10 |

**Total de Domain Events:** [n√∫mero]

---

#### 3.7. RESUMO DA CAMADA DE DOM√çNIO

| Elemento | Quantidade | Status |
|----------|------------|--------|
| Aggregate Roots | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Entities | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Value Objects | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Domain Events | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Repository Interfaces | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Domain Services | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Specifications | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Factories | X | ‚úÖ/‚ö†Ô∏è/‚ùå |

**Nota Geral da Camada de Dom√≠nio: X/10**

---

### 4. CAMADA DE APLICA√á√ÉO - AN√ÅLISE DETALHADA

**Instru√ß√µes:** Explore `/internal/application/` e liste TODOS os use cases e servi√ßos.

#### 4.1. USE CASES / APPLICATION SERVICES

Agrupe por bounded context e liste TODOS os use cases:

**Formato:**
```markdown
#### Bounded Context: [Nome]

| Use Case | Arquivo | Tipo | Depend√™ncias | Nota |
|----------|---------|------|--------------|------|
| CreateContact | `create_contact.go` | Command | ContactRepository, EventBus | 9/10 |
| GetContact | `get_contact.go` | Query | ContactRepository | 8.5/10 |
| [Outro] | [arquivo] | Command/Query/Service | [deps] | X/10 |
```

Fa√ßa isso para TODOS os bounded contexts em `/internal/application/`.

---

#### 4.2. DTOs (Data Transfer Objects)

Liste TODOS os DTOs encontrados:

| DTO | Localiza√ß√£o | Uso | Campos Principais | Nota |
|-----|-------------|-----|-------------------|------|
| ContactDTO | `/internal/application/dtos/contact_dtos.go` | Request/Response | id, name, email, phone | 9/10 |
| [Outro] | [caminho] | [uso] | [campos] | X/10 |

**Total de DTOs:** [n√∫mero]

---

#### 4.3. PORTS (INTERFACES)

Liste TODAS as interfaces de portas (Hexagonal Architecture):

| Port | Localiza√ß√£o | M√©todos | Implementa√ß√µes | Nota |
|------|-------------|---------|----------------|------|
| MessageSender | `/internal/application/message/ports.go` | SendText(), SendMedia() | WAHAAdapter | 8.5/10 |
| [Outro] | [caminho] | [m√©todos] | [impls] | X/10 |

**Ports Ausentes (Oportunidades):**
- `EmailSender` - envio de emails
- `SMSSender` - envio de SMS
- [Outros...]

---

#### 4.4. CQRS (Command Query Responsibility Segregation)

Avalie a separa√ß√£o de Commands e Queries:

**Estrutura de Pastas:**
- `/internal/application/commands/` - ‚úÖ Existe / ‚ùå N√£o existe / ‚ö†Ô∏è Vazio
- `/internal/application/queries/` - ‚úÖ Existe / ‚ùå N√£o existe / ‚ö†Ô∏è Vazio

**Nomenclatura:**
- Commands terminam com `Command`? ‚úÖ/‚ùå
- Queries terminam com `Query`? ‚úÖ/‚ùå
- Handlers separados? ‚úÖ/‚ùå

**Nota CQRS:** X/10

**Recomenda√ß√£o:** [Se n√£o implementado, sugerir estrutura]

---

#### 4.5. EVENT HANDLERS / SUBSCRIBERS

Liste TODOS os event handlers/subscribers encontrados:

| Handler | Localiza√ß√£o | Event Subscrito | A√ß√£o | Nota |
|---------|-------------|-----------------|------|------|
| [Nome] | [caminho] | [event] | [a√ß√£o] | X/10 |

---

#### 4.6. RESUMO DA CAMADA DE APLICA√á√ÉO

| Elemento | Quantidade | Status |
|----------|------------|--------|
| Use Cases | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| DTOs | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Ports | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Event Handlers | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| CQRS Expl√≠cito | - | ‚úÖ/‚ö†Ô∏è/‚ùå |

**Nota Geral da Camada de Aplica√ß√£o: X/10**

---

### 5. CAMADA DE INFRAESTRUTURA - AN√ÅLISE DETALHADA

**Instru√ß√µes:** Explore `/infrastructure/` e mapeie TODAS as implementa√ß√µes.

#### 5.1. REPOSITORIES (Implementa√ß√µes)

Liste TODOS os repositories implementados:

| Repository | Arquivo | Agregado | M√©todos Principais | Nota |
|------------|---------|----------|-------------------|------|
| GormContactRepository | `/infrastructure/persistence/gorm_contact_repository.go` | Contact | Save(), FindByID(), FindByEmail() | 9.5/10 |
| [Outro] | [caminho] | [agregado] | [m√©todos] | X/10 |

**Total de Repositories:** [n√∫mero]

**Avalia√ß√£o:**
- Todos os agregados t√™m repository? ‚úÖ/‚ùå
- Repositories implementam interface do dom√≠nio? ‚úÖ/‚ùå
- Uso correto de transa√ß√µes? ‚úÖ/‚ùå

---

#### 5.2. ENTIDADES GORM (Persist√™ncia)

Liste TODAS as entidades GORM encontradas em `/infrastructure/persistence/entities/`:

| Entidade GORM | Arquivo | Agregado Correspondente | Relacionamentos | Nota |
|---------------|---------|-------------------------|-----------------|------|
| Contact | `contact.go` | domain/contact.Contact | HasMany(Messages) | 9/10 |
| [Outra] | [arquivo] | [agregado] | [rels] | X/10 |

**Total de Entidades GORM:** [n√∫mero]

**Mapeamento Domain ‚Üî Persistence:**
- Mappers expl√≠citos (`domainToEntity`, `entityToDomain`)? ‚úÖ/‚ùå
- Separa√ß√£o clara entre modelo de dom√≠nio e persist√™ncia? ‚úÖ/‚ùå

---

#### 5.3. MIGRA√á√ïES SQL

Analise TODAS as migra√ß√µes em `/infrastructure/database/migrations/`:

**Total de Migra√ß√µes:** [n√∫mero]

**Qualidade das Migra√ß√µes:**
- [ ] Foreign Keys bem definidas
- [ ] √çndices otimizados
- [ ] Constraints (NOT NULL, UNIQUE, CHECK)
- [ ] Tipos de dados adequados
- [ ] Rollback (down migrations) implementado

**Destaques:**
Liste migra√ß√µes importantes:
- `000XXX_create_contacts_table.up.sql` - [descri√ß√£o]
- `000XXX_add_outbox_trigger.up.sql` - [descri√ß√£o]
- [Outras...]

**Consist√™ncia:**
- Migra√ß√µes sincronizadas com entidades GORM? ‚úÖ/‚ùå
- Versionamento sequencial correto? ‚úÖ/‚ùå

**Nota Migra√ß√µes:** X/10

---

#### 5.4. EVENT BUS & OUTBOX PATTERN

Avalie a implementa√ß√£o de eventos:

**Outbox Pattern:**
- Tabela `outbox_events` existe? ‚úÖ/‚ùå
- Trigger PostgreSQL `NOTIFY` implementado? ‚úÖ/‚ùå
- Processor para publicar eventos? ‚úÖ/‚ùå
- Localiza√ß√£o: `/infrastructure/messaging/outbox_processor.go`

**Message Bus (RabbitMQ):**
- Conex√£o configurada? ‚úÖ/‚ùå
- Filas declaradas? ‚úÖ/‚ùå
- Exchanges configurados? ‚úÖ/‚ùå

**Filas Declaradas:**
Liste TODAS as filas encontradas no c√≥digo:
```
domain.events.contact.created
domain.events.contact.updated
domain.events.message.created
[Outras...]
```

**Total de Filas:** [n√∫mero]

**Idempot√™ncia:**
- Tabela `processed_events` existe? ‚úÖ/‚ùå
- Deduplica√ß√£o de eventos implementada? ‚úÖ/‚ùå

**Nota Event Bus:** X/10

---

#### 5.5. HTTP HANDLERS (Interface REST)

Liste TODOS os handlers em `/infrastructure/http/handlers/`:

| Handler | Arquivo | Endpoints | M√©todos HTTP | Nota |
|---------|---------|-----------|--------------|------|
| ContactHandler | `contact_handler.go` | /contacts | GET, POST, PUT, DELETE | 8.5/10 |
| [Outro] | [arquivo] | [endpoints] | [m√©todos] | X/10 |

**Total de Handlers:** [n√∫mero]

---

#### 5.6. MIDDLEWARE

Liste TODOS os middlewares em `/infrastructure/http/middleware/`:

| Middleware | Arquivo | Fun√ß√£o | Nota |
|------------|---------|--------|------|
| AuthMiddleware | `auth.go` | Valida√ß√£o JWT | 9/10 |
| RBACMiddleware | `rbac.go` | Controle de acesso | 8.5/10 |
| RLSMiddleware | `rls.go` | Row-Level Security (tenant_id) | 9.5/10 |
| [Outro] | [arquivo] | [fun√ß√£o] | X/10 |

---

#### 5.7. INTEGRA√á√ïES EXTERNAS

Liste TODAS as integra√ß√µes em `/infrastructure/channels/` ou `/infrastructure/`:

| Integra√ß√£o | Localiza√ß√£o | ACL Implementado | Nota |
|------------|-------------|------------------|------|
| WAHA (WhatsApp) | `/infrastructure/channels/waha/` | ‚úÖ Sim | 9/10 |
| [Outra] | [caminho] | ‚úÖ/‚ùå | X/10 |

**ACL (Anti-Corruption Layer):**
- Mapeamento de payloads externos para dom√≠nio? ‚úÖ/‚ùå
- Tratamento de erros espec√≠ficos? ‚úÖ/‚ùå

---

#### 5.8. SEGURAN√áA & CRIPTOGRAFIA

**Criptografia:**
- Implementa√ß√£o: `/infrastructure/crypto/aes_encryptor.go`
- Uso: Credenciais sens√≠veis (OAuth tokens, API keys)
- Algoritmo: AES-256-GCM
- Testes: ‚úÖ/‚ùå

**Row-Level Security (RLS):**
- Middleware implementado? ‚úÖ/‚ùå
- Filtro autom√°tico por `tenant_id`? ‚úÖ/‚ùå
- Aplicado em todos os repositories? ‚úÖ/‚ùå

**Nota Seguran√ßa:** X/10

---

#### 5.9. RESUMO DA CAMADA DE INFRAESTRUTURA

| Elemento | Quantidade | Status |
|----------|------------|--------|
| Repositories | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Entidades GORM | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Migra√ß√µes SQL | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Handlers HTTP | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Middlewares | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Integra√ß√µes | X | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Event Bus | - | ‚úÖ/‚ö†Ô∏è/‚ùå |
| Outbox Pattern | - | ‚úÖ/‚ö†Ô∏è/‚ùå |

**Nota Geral da Camada de Infraestrutura: X/10**

---

### 6. TIPOS, ENUMS E M√ÅQUINAS DE ESTADO

**Instru√ß√µes:** Identifique TODOS os enums/types e m√°quinas de estado no c√≥digo.

#### 6.1. ENUMS RICOS (Smart Enums)

Liste TODOS os enums/types encontrados:

**Formato:**
```markdown
#### Enum: [Nome]
**Localiza√ß√£o:** `/internal/domain/[pasta]/types.go`

**Valores:**
```go
const (
    Valor1 TipoEnum = "valor1"
    Valor2 TipoEnum = "valor2"
    // ...
)
```

**M√©todos:**
- `IsValid() bool` - ‚úÖ/‚ùå
- `Parse(s string) (TipoEnum, error)` - ‚úÖ/‚ùå
- [Outros m√©todos espec√≠ficos]

**Nota:** X/10

**Sugest√µes:**
- [Se faltam m√©todos, sugerir]
```

Fa√ßa isso para TODOS os enums encontrados.

**Total de Enums:** [n√∫mero]

---

#### 6.2. M√ÅQUINAS DE ESTADO

Identifique TODAS as m√°quinas de estado (impl√≠citas ou expl√≠citas):

**Formato:**
```markdown
#### M√°quina de Estado: [Agregado].[Campo]

**Agregado:** [Nome]  
**Campo de Status:** [nome do campo]  
**Tipo:** [tipo do enum]

**Diagrama de Transi√ß√µes:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ estado1 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îú‚îÄ‚îÄ[a√ß√£o1]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> estado2
     ‚îÇ
     ‚îî‚îÄ‚îÄ[a√ß√£o2]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> estado3
```

**Transi√ß√µes V√°lidas:**
- `estado1 -> estado2` (via a√ß√£o1)
- `estado1 -> estado3` (via a√ß√£o2)

**Transi√ß√µes Inv√°lidas:**
- `estado2 -> estado1` ‚ùå
- `estado3 -> estado1` ‚ùå

**Implementa√ß√£o:**
- M√©todo `CanTransitionTo(newStatus Status) bool` existe? ‚úÖ/‚ùå
- Valida√ß√£o de transi√ß√µes no c√≥digo? ‚úÖ/‚ùå
- Tipo: Expl√≠cita / Impl√≠cita

**Nota:** X/10

**Sugest√£o:**
[Se impl√≠cita, sugerir criar m√©todo CanTransitionTo() e ValidTransitions()]
```

Fa√ßa isso para TODAS as m√°quinas de estado encontradas (ex: Session.Status, Message.Status, Pipeline.Active, etc.).

**Total de M√°quinas de Estado:** [n√∫mero]

---

### 7. AN√ÅLISE DE CONSIST√äNCIA

#### 7.1. NOMENCLATURA

Avalie a consist√™ncia de nomenclatura em TODO o c√≥digo:

**Construtores:**
- Padr√£o usado: `New*` / `Create*` / Misto
- Consistente em todos os agregados? ‚úÖ/‚ùå
- Exemplos: [liste alguns]

**Reconstrutores:**
- Padr√£o usado: `Reconstruct*` / `From*` / Outro
- Consistente? ‚úÖ/‚ùå
- Exemplos: [liste alguns]

**Getters:**
- Seguem padr√£o Go (sem prefixo `Get`)? ‚úÖ/‚ùå
- Exemplos: `ID()`, `Name()`, `Email()`

**M√©todos de Neg√≥cio:**
- Usam verbos claros? ‚úÖ/‚ùå
- Exemplos: `UpdateName()`, `MarkAsRead()`, `Close()`

**Nota Nomenclatura:** X/10

---

#### 7.2. PADR√ïES ARQUITETURAIS

Verifique a implementa√ß√£o dos padr√µes:

| Padr√£o | Implementado | Qualidade | Observa√ß√µes |
|--------|--------------|-----------|-------------|
| **Repository Pattern** | ‚úÖ/‚ùå | X/10 | Interface no dom√≠nio, impl na infra |
| **Dependency Inversion** | ‚úÖ/‚ùå | X/10 | Portas e adaptadores |
| **Domain Events** | ‚úÖ/‚ùå | X/10 | Todos os agregados emitem? |
| **Encapsulamento** | ‚úÖ/‚ùå | X/10 | Campos privados + getters |
| **Invariantes** | ‚úÖ/‚ùå | X/10 | Validadas nos construtores |
| **Outbox Pattern** | ‚úÖ/‚ùå | X/10 | Consist√™ncia eventual |
| **CQRS** | ‚úÖ/‚ùå | X/10 | Separa√ß√£o expl√≠cita |
| **ACL** | ‚úÖ/‚ùå | X/10 | Anti-Corruption Layer |

---

#### 7.3. ESTRUTURA DE PASTAS

Avalie a organiza√ß√£o do projeto:

```
/home/caloi/ventros-crm/
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ domain/              ‚úÖ/‚ö†Ô∏è/‚ùå [nota]
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ [bounded_context]/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shared/
‚îÇ   ‚îî‚îÄ‚îÄ application/         ‚úÖ/‚ö†Ô∏è/‚ùå [nota]
‚îÇ       ‚îú‚îÄ‚îÄ [bounded_context]/
‚îÇ       ‚îú‚îÄ‚îÄ commands/        ‚úÖ/‚ö†Ô∏è/‚ùå [vazio?]
‚îÇ       ‚îú‚îÄ‚îÄ queries/         ‚úÖ/‚ö†Ô∏è/‚ùå [vazio?]
‚îÇ       ‚îî‚îÄ‚îÄ dtos/
‚îú‚îÄ‚îÄ infrastructure/          ‚úÖ/‚ö†Ô∏è/‚ùå [nota]
‚îÇ   ‚îú‚îÄ‚îÄ persistence/
‚îÇ   ‚îú‚îÄ‚îÄ http/
‚îÇ   ‚îú‚îÄ‚îÄ messaging/
‚îÇ   ‚îî‚îÄ‚îÄ channels/
‚îî‚îÄ‚îÄ cmd/                     ‚úÖ/‚ö†Ô∏è/‚ùå [nota]
```

**Problemas Identificados:**
- [Liste pastas vazias ou mal organizadas]
- [Liste arquivos fora do lugar]

**Nota Estrutura:** X/10

---

### 8. OPORTUNIDADES DE MELHORIA

Liste sugest√µes PRIORIZADAS e ESPEC√çFICAS:

#### üî¥ PRIORIDADE ALTA (Impacto Cr√≠tico)

**1. [T√≠tulo da Melhoria]**
- **Problema Atual:** [Descreva o problema encontrado no c√≥digo]
- **Localiza√ß√£o:** [Arquivo/pasta espec√≠fica]
- **Impacto:** [Consequ√™ncias do problema]
- **Solu√ß√£o Sugerida:** [Como resolver]
- **Exemplo de C√≥digo:**
```go
// Antes (problem√°tico)
[c√≥digo atual]

// Depois (sugerido)
[c√≥digo melhorado]
```

**2. [Outra Melhoria]**
[Mesmo formato...]

---

#### üü° PRIORIDADE M√âDIA (Melhoria Significativa)

**1. [T√≠tulo]**
- **Problema Atual:** ...
- **Localiza√ß√£o:** ...
- **Impacto:** ...
- **Solu√ß√£o Sugerida:** ...

[Continue para todas as melhorias de prioridade m√©dia]

---

#### üü¢ PRIORIDADE BAIXA (Refinamento)

**1. [T√≠tulo]**
- **Problema Atual:** ...
- **Localiza√ß√£o:** ...
- **Impacto:** ...
- **Solu√ß√£o Sugerida:** ...

[Continue para todas as melhorias de prioridade baixa]

---

### 9. RESUMO EXECUTIVO FINAL

#### 9.1. TABELA DE NOTAS POR CATEGORIA

| Categoria | Nota | Status | Justificativa |
|-----------|------|--------|---------------|
| **Agregados & Entidades** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |
| **Value Objects** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |
| **Domain Events** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |
| **Repositories** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |
| **Use Cases** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |
| **DTOs** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |
| **Handlers** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |
| **Migra√ß√µes** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |
| **Event Bus** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |
| **Seguran√ßa** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |
| **Testes** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |
| **Documenta√ß√£o** | X/10 | ‚úÖ/‚ö†Ô∏è/‚ùå | [breve justificativa] |

### **NOTA GERAL: X.X/10**

---

#### 9.2. PONTOS FORTES (TOP 5)

1. **[Ponto Forte 1]**
   - Descri√ß√£o detalhada
   - Exemplo no c√≥digo
   - Por que √© excelente

2. **[Ponto Forte 2]**
   [Mesmo formato...]

[Continue at√© 5 pontos fortes]

---

#### 9.3. PONTOS CR√çTICOS (TOP 5)

1. **[Ponto Cr√≠tico 1]**
   - Descri√ß√£o do problema
   - Impacto no sistema
   - Urg√™ncia de corre√ß√£o

2. **[Ponto Cr√≠tico 2]**
   [Mesmo formato...]

[Continue at√© 5 pontos cr√≠ticos]

---

#### 9.4. CONCLUS√ÉO

**Estado Atual da Arquitetura:**
[Par√°grafo descrevendo o estado geral do sistema]

**Conformidade com DDD:**
[Avalia√ß√£o de quanto o sistema segue os princ√≠pios de DDD (Eric Evans, Vaughn Vernon)]

**Conformidade com Clean Architecture:**
[Avalia√ß√£o da separa√ß√£o de camadas e depend√™ncias]

**Recomenda√ß√£o Final:**
- [ ] ‚úÖ **Pronto para produ√ß√£o** - Sistema maduro, poucas melhorias necess√°rias
- [ ] ‚ö†Ô∏è **Pronto com ressalvas** - Funcional, mas precisa de melhorias incrementais
- [ ] ‚ùå **Precisa refatora√ß√£o** - Problemas arquiteturais cr√≠ticos

**Pr√≥ximos Passos Sugeridos:**
1. [A√ß√£o priorit√°ria 1]
2. [A√ß√£o priorit√°ria 2]
3. [A√ß√£o priorit√°ria 3]

---

## üìö REFER√äNCIAS UTILIZADAS

- **Domain-Driven Design** (Eric Evans, 2003)
- **Implementing Domain-Driven Design** (Vaughn Vernon, 2013)
- **Clean Architecture** (Robert C. Martin, 2017)
- **Patterns of Enterprise Application Architecture** (Martin Fowler, 2002)

---

## üîç INSTRU√á√ïES CR√çTICAS PARA A IA

### IMPORTANTE: LEIA ANTES DE COME√áAR

1. **Voc√™ TEM acesso ao c√≥digo:** Explore `/home/caloi/ventros-crm/` completamente
2. **N√£o assuma nada:** Leia TODOS os arquivos relevantes antes de avaliar
3. **Seja espec√≠fico:** Cite arquivos, linhas, nomes de classes/m√©todos
4. **Seja completo:** N√£o pule bounded contexts, agregados ou elementos
5. **Seja rigoroso:** Avalie com base em DDD puro (Eric Evans, Vaughn Vernon)
6. **Seja construtivo:** Toda cr√≠tica DEVE vir com sugest√£o de melhoria
7. **Use exemplos:** Mostre c√≥digo real do projeto (bom e problem√°tico)
8. **Priorize:** Foque no que realmente importa para a arquitetura

### FORMATO DE SA√çDA

- **Arquivo:** Sobrescreva `/home/caloi/ventros-crm/TASKS-2.md` com sua an√°lise
- **Formato:** Markdown completo e naveg√°vel
- **Tamanho:** 1500-2500 linhas (an√°lise detalhada)
- **Elementos:** √çndice clic√°vel, emojis, tabelas, blocos de c√≥digo, diagramas ASCII

### ESTRUTURA OBRIGAT√ìRIA

Siga EXATAMENTE a estrutura definida acima:
1. Sum√°rio Executivo
2. Bounded Contexts Identificados
3. Camada de Dom√≠nio (3.1 a 3.7)
4. Camada de Aplica√ß√£o (4.1 a 4.6)
5. Camada de Infraestrutura (5.1 a 5.9)
6. Tipos, Enums e M√°quinas de Estado (6.1 a 6.2)
7. An√°lise de Consist√™ncia (7.1 a 7.3)
8. Oportunidades de Melhoria (Prioridade Alta/M√©dia/Baixa)
9. Resumo Executivo Final (9.1 a 9.4)

---

## üìã CHECKLIST DE COMPLETUDE

Antes de finalizar, verifique se sua an√°lise inclui:

### Camada de Dom√≠nio
- [ ] Todos os bounded contexts identificados (espera-se 6-10)
- [ ] Todos os agregados mapeados com detalhes completos (espera-se 15+)
- [ ] Todos os value objects listados (espera-se 6+)
- [ ] Todos os domain events documentados (espera-se 45+)
- [ ] Todos os repository interfaces listados (espera-se 15+)
- [ ] Domain services identificados (ou aus√™ncia indicada)
- [ ] Specifications identificadas (ou aus√™ncia indicada)
- [ ] Factories identificadas (expl√≠citas ou impl√≠citas via New*)

### Camada de Aplica√ß√£o
- [ ] Todos os use cases mapeados por bounded context (espera-se 30+)
- [ ] Todos os DTOs listados (espera-se 5+)
- [ ] Todos os ports/interfaces identificados
- [ ] CQRS avaliado (estrutura de pastas, nomenclatura)
- [ ] Event handlers/subscribers listados

### Camada de Infraestrutura
- [ ] Todos os repositories implementados (espera-se 17+)
- [ ] Todas as entidades GORM mapeadas (espera-se 26+)
- [ ] Todas as migra√ß√µes SQL analisadas (espera-se 26+)
- [ ] Event Bus & Outbox Pattern avaliados
- [ ] Filas RabbitMQ listadas (espera-se 45+)
- [ ] Handlers HTTP listados (espera-se 18+)
- [ ] Middlewares listados (espera-se 4+)
- [ ] Integra√ß√µes externas avaliadas
- [ ] Seguran√ßa & criptografia analisadas

### Tipos & Estado
- [ ] Todos os enums documentados com m√©todos (espera-se 10+)
- [ ] Todas as m√°quinas de estado identificadas (espera-se 3+)
- [ ] Diagramas ASCII para transi√ß√µes de estado

### An√°lise & Recomenda√ß√µes
- [ ] Nomenclatura avaliada (construtores, getters, m√©todos)
- [ ] Padr√µes arquiteturais verificados (8 padr√µes listados)
- [ ] Estrutura de pastas avaliada
- [ ] Oportunidades de melhoria priorizadas (Alta/M√©dia/Baixa)
- [ ] Cada melhoria com: problema, localiza√ß√£o, impacto, solu√ß√£o, exemplo

### Resumo Final
- [ ] Tabela de notas por categoria (12 categorias)
- [ ] Nota geral calculada
- [ ] Top 5 pontos fortes com justificativas
- [ ] Top 5 pontos cr√≠ticos com impacto
- [ ] Conclus√£o com recomenda√ß√£o (pronto/ressalvas/refatora√ß√£o)
- [ ] Pr√≥ximos passos sugeridos

---

## ‚ö†Ô∏è AVISOS FINAIS

### REGRAS CR√çTICAS:

1. **‚úÖ LISTE TUDO QUE EXISTE** - Mesmo que:
   - N√£o tenha testes
   - Seja apenas estrutura
   - Tenha TODOs
   - Esteja incompleto
   - N√£o tenha l√≥gica

2. **‚ùå LISTE TUDO QUE FALTA** - Indique:
   - Agregados ausentes
   - VOs que deveriam existir
   - M√©todos vazios
   - Testes ausentes
   - Valida√ß√µes faltantes

3. **‚ö†Ô∏è INDIQUE O QUE EST√Å PARCIAL** - Mostre:
   - C√≥digo com TODOs
   - M√©todos sem valida√ß√£o
   - Testes incompletos
   - Documenta√ß√£o parcial

4. **N√ÉO invente dados:** Se n√£o encontrar algo, indique aus√™ncia explicitamente

5. **N√ÉO seja gen√©rico:** Cite arquivos, linhas de c√≥digo, nomes de m√©todos

6. **N√ÉO pule se√ß√µes:** Mesmo que vazia, indique "‚ùå N√£o encontrado"

7. **SIM, seja cr√≠tico:** Avalie com rigor, mas seja construtivo

8. **SIM, d√™ exemplos:** Mostre c√≥digo real do projeto (bom E problem√°tico)

9. **SIM, use % de completude:** Estime implementa√ß√£o (ex: "85% implementado")

10. **SIM, priorize melhorias:** Use üî¥ Alta / üü° M√©dia / üü¢ Baixa

---

## üéØ COME√áE AGORA

**LEMBRE-SE:** Voc√™ deve trazer **TUDO** - o que existe, o que falta, o que est√° incompleto.

Explore o c√≥digo em `/home/caloi/ventros-crm/` e gere a an√°lise completa sobrescrevendo este arquivo.

**BOA SORTE!** üöÄ
```
