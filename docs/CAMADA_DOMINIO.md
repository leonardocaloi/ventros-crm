# üèõÔ∏è DOCUMENTA√á√ÉO - CAMADA DE DOM√çNIO

**Localiza√ß√£o**: `internal/domain/`
**Prop√≥sito**: Cont√©m a l√≥gica de neg√≥cio pura, independente de frameworks e infraestrutura

---

## üìã √çNDICE

1. [Aggregate Roots](#aggregate-roots)
2. [Value Objects](#value-objects)
3. [Domain Events](#domain-events)
4. [Domain Services](#domain-services)
5. [Repositories (Interfaces)](#repositories)
6. [Regras de Neg√≥cio](#regras-de-neg√≥cio)

---

## 1. AGGREGATE ROOTS

### 1.1 Contact (Contato)

**Arquivo**: `internal/domain/contact/contact.go`

**Responsabilidade**: Gerenciar informa√ß√µes e ciclo de vida de contatos (clientes/leads)

**Invariantes**:
- ‚úÖ Nome n√£o pode ser vazio
- ‚úÖ Email deve ser v√°lido (se fornecido)
- ‚úÖ Phone deve ser normalizado
- ‚úÖ Soft delete (deletedAt != nil)
- ‚úÖ Tags n√£o podem ter duplicatas

**M√©todos Principais**:

```go
// Factory Method
NewContact(projectID, tenantID, name) (*Contact, error)

// Comandos
contact.SetEmail(email string) error
contact.SetPhone(phone string) error
contact.UpdateName(name string) error
contact.AddTag(tag string)
contact.RemoveTag(tag string)
contact.SetProfilePicture(url string)
contact.RecordInteraction()
contact.SoftDelete() error

// Queries
contact.ID() uuid.UUID
contact.Name() string
contact.Email() *Email
contact.Phone() *Phone
contact.IsDeleted() bool
contact.Tags() []string
```

**Domain Events Publicados**:
- `ContactCreatedEvent`: Quando contato √© criado
- `ContactUpdatedEvent`: Quando informa√ß√µes mudam
- `ContactDeletedEvent`: Quando soft delete ocorre
- `ContactProfilePictureUpdatedEvent`: Quando foto de perfil √© atualizada
- `ContactPipelineStatusChangedEvent`: Quando status no pipeline muda

**Regras de Neg√≥cio**:

1. **RN-001**: Contato DEVE ter nome n√£o vazio
2. **RN-002**: Email DEVE ser v√°lido (formato xxx@yyy.zzz)
3. **RN-003**: Phone DEVE ser normalizado (+55XXXXXXXXXXX)
4. **RN-004**: Tags n√£o podem ter duplicatas
5. **RN-005**: Soft delete mant√©m dados para auditoria
6. **RN-006**: ProfilePicture sincronizada do WhatsApp
7. **RN-007**: FirstInteractionAt nunca pode ser alterado ap√≥s set
8. **RN-008**: LastInteractionAt atualiza em toda intera√ß√£o

---

### 1.2 Session (Sess√£o de Atendimento)

**Arquivo**: `internal/domain/session/session.go`

**Responsabilidade**: Gerenciar conversas/atendimentos com timeout autom√°tico

**Invariantes**:
- ‚úÖ ContactID obrigat√≥rio
- ‚úÖ TenantID obrigat√≥rio
- ‚úÖ TimeoutDuration > 0
- ‚úÖ Status v√°lido (Active, Ended)
- ‚úÖ EndReason obrigat√≥rio quando Status = Ended

**M√©todos Principais**:

```go
// Factory Methods
NewSession(contactID, tenantID, channelTypeID, timeoutDuration) (*Session, error)
NewSessionWithPipeline(contactID, tenantID, channelTypeID, pipelineID, timeout) (*Session, error)

// Comandos
session.RecordMessage(fromContact bool, timestamp) error
session.AssignAgent(agentID) error
session.End(reason EndReason) error
session.Resolve() error
session.Escalate() error
session.SetSummary(summary, sentiment, score, topics, nextSteps)

// Queries
session.ID() uuid.UUID
session.ContactID() uuid.UUID
session.IsActive() bool
session.MessageCount() int
session.AgentResponseTimeSeconds() *int
session.ShouldGenerateSummary() bool
```

**Domain Events Publicados**:
- `SessionStartedEvent`: Nova sess√£o criada
- `SessionEndedEvent`: Sess√£o encerrada (manual ou timeout)
- `MessageRecordedEvent`: Mensagem adicionada √† sess√£o
- `AgentAssignedEvent`: Agente atribu√≠do
- `SessionResolvedEvent`: Sess√£o marcada como resolvida
- `SessionEscalatedEvent`: Sess√£o escalada
- `SessionSummarizedEvent`: IA gerou resumo

**Regras de Neg√≥cio**:

1. **RN-S01**: Timeout vem do Pipeline.SessionTimeoutMinutes (default: 30min)
2. **RN-S02**: LastActivityAt atualiza em TODA mensagem (reset timeout)
3. **RN-S03**: AgentResponseTimeSeconds = tempo at√© primeira resposta do agente
4. **RN-S04**: ContactWaitTimeSeconds = tempo at√© primeira resposta do contato
5. **RN-S05**: AgentTransfers incrementa quando troca de agente
6. **RN-S06**: Sess√£o SOMENTE pode ser resolvida ap√≥s EndedAt != nil
7. **RN-S07**: Sess√£o ativa N√ÉO pode ser deletada
8. **RN-S08**: Summary gerado SOMENTE se messageCount >= 3

---

### 1.3 Message (Mensagem)

**Arquivo**: `internal/domain/message/message.go`

**Responsabilidade**: Representar mensagens individuais (text, media, etc)

**Invariantes**:
- ‚úÖ ContactID obrigat√≥rio
- ‚úÖ ProjectID obrigat√≥rio
- ‚úÖ CustomerID obrigat√≥rio
- ‚úÖ ContentType v√°lido (Text, Image, Audio, Video, Document, etc)
- ‚úÖ ChannelID obrigat√≥rio (toda mensagem vem de um canal)

**M√©todos Principais**:

```go
// Factory Method
NewMessage(contactID, projectID, customerID, contentType, fromMe) (*Message, error)

// Comandos
message.SetText(text string) error
message.SetMediaContent(url, mimetype string) error
message.AssignToChannel(channelID, channelTypeID)
message.AssignToSession(sessionID)
message.SetChannelMessageID(channelMessageID) // Para dedup
message.MarkAsDelivered()
message.MarkAsRead()
message.MarkAsFailed()

// Queries
message.ID() uuid.UUID
message.IsInbound() bool // Do contato
message.IsOutbound() bool // Para o contato
message.HasMediaURL() bool
message.Status() Status
```

**Domain Events Publicados**:
- `MessageCreatedEvent`: Nova mensagem
- `MessageDeliveredEvent`: ACK de entrega
- `MessageReadEvent`: Lido pelo destinat√°rio

**Regras de Neg√≥cio**:

1. **RN-M01**: ContentType.IsText() ‚Üí DEVE ter text != nil
2. **RN-M02**: ContentType.IsMedia() ‚Üí DEVE ter mediaURL != nil
3. **RN-M03**: ChannelMessageID usado para deduplica√ß√£o
4. **RN-M04**: FromMe = false ‚Üí Inbound, FromMe = true ‚Üí Outbound
5. **RN-M05**: DeliveredAt SEMPRE < ReadAt (se ambos existem)
6. **RN-M06**: Status transitions: Sent ‚Üí Delivered ‚Üí Read
7. **RN-M07**: Failed messages N√ÉO transitam para Delivered

---

### 1.4 Agent (Agente)

**Arquivo**: `internal/domain/agent/agent.go`

**Responsabilidade**: Representar agentes (humanos, IA, bots) que interagem com contatos

**Invariantes**:
- ‚úÖ ProjectID obrigat√≥rio
- ‚úÖ TenantID obrigat√≥rio
- ‚úÖ Name n√£o vazio
- ‚úÖ AgentType v√°lido (Human, AI, Bot, Channel)
- ‚úÖ Human agents DEVEM ter UserID
- ‚úÖ AI agents DEVEM ter config (provider, model)

**M√©todos Principais**:

```go
// Factory Method
NewAgent(projectID, tenantID, name, agentType, userID) (*Agent, error)

// Comandos
agent.UpdateProfile(name, email) error
agent.Activate() error
agent.Deactivate() error
agent.RecordLogin()
agent.GrantPermission(permission) error
agent.RevokePermission(permission) error
agent.SetStatus(status)
agent.SetConfig(config) // Para AI agents
agent.RecordSessionHandled(responseTimeMs)

// Queries
agent.ID() uuid.UUID
agent.Type() AgentType
agent.IsActive() bool
agent.HasPermission(permission) bool
agent.SessionsHandled() int
agent.AverageResponseMs() int
```

**Domain Events Publicados**:
- `AgentCreatedEvent`
- `AgentUpdatedEvent`
- `AgentActivatedEvent`
- `AgentDeactivatedEvent`
- `AgentLoggedInEvent`
- `AgentPermissionGrantedEvent`
- `AgentPermissionRevokedEvent`

**Regras de Neg√≥cio**:

1. **RN-A01**: AgentType = Human ‚Üí userID obrigat√≥rio
2. **RN-A02**: AgentType = AI ‚Üí config.provider e config.model obrigat√≥rios
3. **RN-A03**: AgentType = Bot ‚Üí config.workflow obrigat√≥rio
4. **RN-A04**: AgentType = Channel ‚Üí representa canal (n√£o usu√°rio)
5. **RN-A05**: AverageResponseMs = m√©dia m√≥vel (n√£o acumula hist√≥rico todo)
6. **RN-A06**: LastActivityAt atualiza em RecordSessionHandled()
7. **RN-A07**: Status = Available, Busy, Away, Offline

---

### 1.5 Pipeline (Funil de Vendas)

**Arquivo**: `internal/domain/pipeline/pipeline.go`

**Responsabilidade**: Gerenciar fluxos de contatos com m√∫ltiplos status/est√°gios

**Invariantes**:
- ‚úÖ Name n√£o vazio
- ‚úÖ ProjectID obrigat√≥rio
- ‚úÖ Statuses n√£o podem estar vazios
- ‚úÖ Status order DEVE ser √∫nico
- ‚úÖ SessionTimeoutMinutes > 0

**M√©todos Principais**:

```go
// Factory Method
NewPipeline(projectID, tenantID, name) (*Pipeline, error)

// Comandos
pipeline.AddStatus(name, order, color) error
pipeline.UpdateStatusOrder(statusID, newOrder) error
pipeline.RemoveStatus(statusID) error
pipeline.SetSessionTimeout(minutes int)
pipeline.Activate()
pipeline.Deactivate()

// Queries
pipeline.ID() uuid.UUID
pipeline.Name() string
pipeline.Statuses() []*PipelineStatus
pipeline.IsActive() bool
pipeline.GetStatus(statusID) *PipelineStatus
```

**Domain Events Publicados**:
- `PipelineCreatedEvent`
- `PipelineStatusAddedEvent`
- `PipelineStatusUpdatedEvent`
- `ContactEnteredPipelineEvent`
- `ContactExitedPipelineEvent`
- `ContactStatusChangedEvent`

**Regras de Neg√≥cio**:

1. **RN-P01**: SessionTimeoutMinutes define timeout de Session
2. **RN-P02**: Status.Order DEVE ser √∫nico dentro do pipeline
3. **RN-P03**: Status N√ÉO pode ser removido se tiver contatos
4. **RN-P04**: Pipeline inativo N√ÉO aceita novos contatos
5. **RN-P05**: Mudan√ßa de status SEMPRE gera ContactStatusChangedEvent

---

### 1.6 Tracking (Rastreamento UTM)

**Arquivo**: `internal/domain/tracking/tracking.go`

**Responsabilidade**: Rastrear origem de contatos (ads, campanhas, landing pages)

**Invariantes**:
- ‚úÖ ContactID obrigat√≥rio
- ‚úÖ SessionID obrigat√≥rio
- ‚úÖ MessageID obrigat√≥rio
- ‚úÖ Source n√£o vazio
- ‚úÖ UTM parameters validados

**M√©todos Principais**:

```go
// Builder Pattern
builder := NewTrackingBuilder(contactID, sessionID, messageID)
builder.WithUTMSource("google")
builder.WithUTMCampaign("summer-2024")
builder.WithGCLID("abc123")
builder.Build() (*Tracking, error)

// Comandos
tracking.EnrichWithFBCLID(fbclid)
tracking.EnrichWithGCLID(gclid)
tracking.SetConversionValue(value)

// Queries
tracking.ID() uuid.UUID
tracking.GetUTMSource() string
tracking.IsMetaAd() bool
tracking.IsGoogleAd() bool
```

**Domain Events Publicados**:
- `TrackingCreatedEvent`
- `TrackingEnrichedEvent`
- `AdConversionTrackedEvent`

**Regras de Neg√≥cio**:

1. **RN-T01**: utm_source = "meta" ‚Üí tracking de Meta Ads
2. **RN-T02**: utm_source = "google" ‚Üí tracking de Google Ads
3. **RN-T03**: fbclid detectado ‚Üí enrichment autom√°tico Meta
4. **RN-T04**: gclid detectado ‚Üí enrichment autom√°tico Google
5. **RN-T05**: Conversion value SOMENTE para ads pagos

---

## 2. VALUE OBJECTS

### 2.1 Email

**Arquivo**: `internal/domain/contact/value_objects.go`

```go
type Email struct {
    value string
}

func NewEmail(email string) (Email, error) {
    // Valida√ß√£o de formato
    // Normaliza√ß√£o (lowercase)
}
```

**Invariantes**:
- ‚úÖ Formato v√°lido (regex: `^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$`)
- ‚úÖ Case insensitive (sempre lowercase)
- ‚úÖ Immutable

### 2.2 Phone

**Arquivo**: `internal/domain/contact/value_objects.go`

```go
type Phone struct {
    value string // Formato: +55XXXXXXXXXXX
}

func NewPhone(phone string) (Phone, error) {
    // Normaliza√ß√£o (+55)
    // Remo√ß√£o de caracteres especiais
}
```

**Invariantes**:
- ‚úÖ Formato internacional (+DDI)
- ‚úÖ Apenas d√≠gitos (remove espa√ßos, par√™nteses, h√≠fens)
- ‚úÖ Immutable

### 2.3 TenantID

**Arquivo**: `internal/domain/shared/tenant_id.go`

```go
type TenantID struct {
    value string
}
```

**Invariantes**:
- ‚úÖ N√£o vazio
- ‚úÖ Type-safe (n√£o √© string comum)
- ‚úÖ Usado em RLS (Row Level Security)

### 2.4 CustomField

**Arquivo**: `internal/domain/shared/custom_field.go`

```go
type CustomField struct {
    Key   string
    Value interface{}
    Type  CustomFieldType // String, Number, Boolean, Date
}
```

**Invariantes**:
- ‚úÖ Key n√£o vazio
- ‚úÖ Type v√°lido
- ‚úÖ Value compat√≠vel com Type

---

## 3. DOMAIN EVENTS

### 3.1 BaseEvent (Padr√£o)

**Arquivo**: `internal/domain/shared/domain_event.go`

```go
type DomainEvent interface {
    EventName() string       // Ex: "contact.created"
    EventID() uuid.UUID      // ID √∫nico (idempot√™ncia)
    EventVersion() string    // Ex: "v1" (schema evolution)
    OccurredAt() time.Time   // Timestamp
}

type BaseEvent struct {
    eventID      uuid.UUID
    eventName    string
    eventVersion string
    occurredAt   time.Time
}
```

**Todos os eventos DEVEM**:
- ‚úÖ Embedar `BaseEvent`
- ‚úÖ Ter construtor `NewXxxEvent()`
- ‚úÖ Ser imut√°veis
- ‚úÖ Carregar estado necess√°rio (Event Carried State Transfer)

### 3.2 Eventos por Agregado

**Contact**:
- `ContactCreatedEvent`
- `ContactUpdatedEvent`
- `ContactDeletedEvent`
- `ContactProfilePictureUpdatedEvent`
- `ContactPipelineStatusChangedEvent`
- `AdConversionTrackedEvent`

**Session**:
- `SessionStartedEvent`
- `SessionEndedEvent`
- `MessageRecordedEvent`
- `AgentAssignedEvent`
- `SessionResolvedEvent`
- `SessionEscalatedEvent`
- `SessionSummarizedEvent`

**Message**:
- `MessageCreatedEvent`
- `MessageDeliveredEvent`
- `MessageReadEvent`

**Agent**:
- `AgentCreatedEvent`
- `AgentUpdatedEvent`
- `AgentActivatedEvent`
- `AgentDeactivatedEvent`
- `AgentLoggedInEvent`
- `AgentPermissionGrantedEvent`
- `AgentPermissionRevokedEvent`

**Pipeline**:
- `PipelineCreatedEvent`
- `PipelineStatusAddedEvent`
- `ContactEnteredPipelineEvent`
- `ContactExitedPipelineEvent`
- `ContactStatusChangedEvent`

**Tracking**:
- `TrackingCreatedEvent`
- `TrackingEnrichedEvent`

**Note**:
- `NoteAddedEvent`
- `NoteUpdatedEvent`
- `NoteDeletedEvent`
- `NotePinnedEvent`

---

## 4. DOMAIN SERVICES

### 4.1 Quando Usar Domain Services

**Crit√©rio**: L√≥gica de neg√≥cio que **N√ÉO** pertence a um √∫nico agregado

**Exemplos**:
- ‚ùå `Contact.UpdateName()` ‚Üí Pertence ao Contact (m√©todo do agregado)
- ‚úÖ `TransferContactBetweenProjects(contactID, fromProject, toProject)` ‚Üí Domain Service (afeta m√∫ltiplos agregados)

**Implementados**:

```go
// internal/domain/messaging/message_sender.go
type MessageSender interface {
    SendMessage(ctx, to, text) error
    SendMedia(ctx, to, mediaType, url) error
}
```

---

## 5. REPOSITORIES (INTERFACES)

**Padr√£o**: Definidas no dom√≠nio, implementadas na infra

```go
// internal/domain/contact/repository.go
type Repository interface {
    Save(ctx context.Context, contact *Contact) error
    FindByID(ctx context.Context, id uuid.UUID) (*Contact, error)
    FindByPhone(ctx context.Context, phone Phone) (*Contact, error)
    FindByEmail(ctx context.Context, email Email) (*Contact, error)
    List(ctx context.Context, filters ContactFilters) ([]*Contact, error)
    Delete(ctx context.Context, id uuid.UUID) error
}
```

**Reposit√≥rios Definidos**:
- `contact.Repository`
- `session.Repository`
- `message.Repository`
- `agent.Repository`
- `pipeline.Repository`
- `tracking.Repository`
- `note.Repository`
- `webhook.Repository`
- `outbox.Repository`

---

## 6. REGRAS DE NEG√ìCIO (RESUMO)

### 6.1 Contact (Contato)

| ID | Regra |
|----|-------|
| RN-001 | Nome obrigat√≥rio e n√£o vazio |
| RN-002 | Email deve ser v√°lido (se fornecido) |
| RN-003 | Phone normalizado (+55XXXXXXXXXXX) |
| RN-004 | Tags sem duplicatas |
| RN-005 | Soft delete mant√©m dados |
| RN-006 | ProfilePicture sincronizada do WhatsApp |
| RN-007 | FirstInteractionAt imut√°vel |
| RN-008 | LastInteractionAt atualiza em toda intera√ß√£o |

### 6.2 Session (Sess√£o)

| ID | Regra |
|----|-------|
| RN-S01 | Timeout vem do Pipeline (default: 30min) |
| RN-S02 | LastActivityAt reset em toda mensagem |
| RN-S03 | AgentResponseTime = tempo at√© 1¬™ resposta |
| RN-S04 | ContactWaitTime = tempo at√© 1¬™ resposta do contato |
| RN-S05 | AgentTransfers incrementa em troca |
| RN-S06 | Resolve SOMENTE ap√≥s EndedAt != nil |
| RN-S07 | Sess√£o ativa N√ÉO pode ser deletada |
| RN-S08 | Summary gerado se messageCount >= 3 |

### 6.3 Message (Mensagem)

| ID | Regra |
|----|-------|
| RN-M01 | Text message ‚Üí text obrigat√≥rio |
| RN-M02 | Media message ‚Üí mediaURL obrigat√≥rio |
| RN-M03 | ChannelMessageID para dedup |
| RN-M04 | FromMe define dire√ß√£o |
| RN-M05 | DeliveredAt < ReadAt |
| RN-M06 | Status: Sent ‚Üí Delivered ‚Üí Read |
| RN-M07 | Failed n√£o transita para Delivered |

### 6.4 Agent (Agente)

| ID | Regra |
|----|-------|
| RN-A01 | Human ‚Üí UserID obrigat√≥rio |
| RN-A02 | AI ‚Üí config (provider, model) obrigat√≥rio |
| RN-A03 | Bot ‚Üí config.workflow obrigat√≥rio |
| RN-A04 | Channel ‚Üí representa canal, n√£o usu√°rio |
| RN-A05 | AverageResponseMs = m√©dia m√≥vel |
| RN-A06 | LastActivityAt atualiza em handling |
| RN-A07 | Status: Available, Busy, Away, Offline |

### 6.5 Pipeline (Funil)

| ID | Regra |
|----|-------|
| RN-P01 | SessionTimeoutMinutes define timeout de Session |
| RN-P02 | Status.Order √∫nico no pipeline |
| RN-P03 | Status com contatos N√ÉO pode ser removido |
| RN-P04 | Pipeline inativo N√ÉO aceita novos contatos |
| RN-P05 | Mudan√ßa status SEMPRE gera evento |

### 6.6 Tracking (Rastreamento)

| ID | Regra |
|----|-------|
| RN-T01 | utm_source = "meta" ‚Üí Meta Ads |
| RN-T02 | utm_source = "google" ‚Üí Google Ads |
| RN-T03 | fbclid ‚Üí enrichment Meta |
| RN-T04 | gclid ‚Üí enrichment Google |
| RN-T05 | Conversion value SOMENTE ads pagos |

---

## üìñ BOUNDED CONTEXTS

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  CONTACT MANAGEMENT                                     ‚îÇ
‚îÇ  - Contact (AR)                                         ‚îÇ
‚îÇ  - ContactEvent                                         ‚îÇ
‚îÇ  - ContactList                                          ‚îÇ
‚îÇ  - CustomFields                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  SESSION MANAGEMENT                                     ‚îÇ
‚îÇ  - Session (AR)                                         ‚îÇ
‚îÇ  - Message                                              ‚îÇ
‚îÇ  - AgentSession                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  AGENT MANAGEMENT                                       ‚îÇ
‚îÇ  - Agent (AR)                                           ‚îÇ
‚îÇ  - Permissions                                          ‚îÇ
‚îÇ  - AI Provider Integration                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PIPELINE MANAGEMENT                                    ‚îÇ
‚îÇ  - Pipeline (AR)                                        ‚îÇ
‚îÇ  - PipelineStatus                                       ‚îÇ
‚îÇ  - Status Transitions                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  CHANNEL MANAGEMENT                                     ‚îÇ
‚îÇ  - Channel (AR)                                         ‚îÇ
‚îÇ  - ChannelType                                          ‚îÇ
‚îÇ  - WAHA Integration                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  TRACKING & ATTRIBUTION                                 ‚îÇ
‚îÇ  - Tracking (AR)                                        ‚îÇ
‚îÇ  - UTM Parameters                                       ‚îÇ
‚îÇ  - Ad Conversion                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  BILLING                                                ‚îÇ
‚îÇ  - BillingAccount (AR)                                  ‚îÇ
‚îÇ  - Customer                                             ‚îÇ
‚îÇ  - Project                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚úÖ CHECKLIST DE QUALIDADE

### Aggregate Roots
- [x] Factory methods bem definidos
- [x] Reconstruct methods para hidrata√ß√£o
- [x] Invariantes protegidas
- [x] Comandos retornam errors
- [x] Queries nunca modificam estado
- [x] Domain events publicados corretamente
- [x] Getters imut√°veis (retornam c√≥pias)

### Value Objects
- [x] Imut√°veis
- [x] Valida√ß√£o no construtor
- [x] Equality baseado em valor
- [x] Sem ID pr√≥prio

### Domain Events
- [x] Implementam DomainEvent
- [x] T√™m EventID (idempot√™ncia)
- [x] T√™m EventVersion (schema evolution)
- [x] Construtores padronizados
- [x] Carregam estado necess√°rio

### Repositories
- [x] Interfaces no dom√≠nio
- [x] Implementa√ß√µes na infra
- [x] Retornam agregados completos
- [x] Save/FindByID/Delete padr√£o

---

**Pr√≥ximo**: Ver [Camada de Aplica√ß√£o](./CAMADA_APLICACAO.md)
